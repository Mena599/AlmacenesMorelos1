-- ==========================
-- ESQUEMA NUEVO ALMACENES
-- ==========================

-- USUARIOS (SUPERADMIN | ADMIN_SEDE | CLIENTE)
CREATE TABLE USUARIOS (
    ID_USUARIO      NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOMBRE          VARCHAR2(50)      NOT NULL,
    APELLIDO        VARCHAR2(50)      NOT NULL,
    CORREO          VARCHAR2(100)     NOT NULL UNIQUE,
    USUARIO         VARCHAR2(30)      NOT NULL UNIQUE,
    CONTRASEÑA      VARCHAR2(255)     NOT NULL,        -- guarda hash (bcrypt)
    ROL             VARCHAR2(20)      NOT NULL
        CHECK (ROL IN ('SUPERADMIN','ADMIN_SEDE','CLIENTE'))
);

-- SEDES
CREATE TABLE SEDES (
    ID_SEDE         NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    MUNICIPIO       VARCHAR2(50)      NOT NULL,
    ID_ADMIN_SEDE   NUMBER            NULL,
    TELEFONO        VARCHAR2(15)      NULL,
    FECHA_REGISTRO  DATE              DEFAULT SYSDATE,
    CONSTRAINT FK_SEDE_ADMIN
        FOREIGN KEY (ID_ADMIN_SEDE) REFERENCES USUARIOS(ID_USUARIO)
);

-- CLIENTES
CREATE TABLE CLIENTES (
    ID_CLIENTE      NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOMBRE          VARCHAR2(50)      NOT NULL,
    APELLIDOS       VARCHAR2(50)      NOT NULL,
    TELEFONO        VARCHAR2(15),
    CORREO          VARCHAR2(100)
);

-- ALMACENES
CREATE TABLE ALMACENES (
    ID_ALMACEN      NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOMBRE          VARCHAR2(50)      NOT NULL,
    UBICACION       VARCHAR2(100),
    CAPACIDAD       NUMBER,
    PRECIO_RENTA    NUMBER(10,2),
    PRECIO_VENTA    NUMBER(10,2),
    DISPONIBLE      CHAR(1) DEFAULT 'S' CHECK (DISPONIBLE IN ('S','N')),
    ID_SEDE         NUMBER NULL,
    CONSTRAINT FK_ALM_SEDE
        FOREIGN KEY (ID_SEDE) REFERENCES SEDES(ID_SEDE)
);

-- VENTAS (compra definitiva)
CREATE TABLE VENTAS (
    ID_VENTA        NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_CLIENTE      NUMBER NOT NULL REFERENCES CLIENTES(ID_CLIENTE),
    ID_ALMACEN      NUMBER NOT NULL REFERENCES ALMACENES(ID_ALMACEN),
    FECHA           DATE   DEFAULT SYSDATE,
    MONTO           NUMBER(10,2)
);

-- RENTAS (alquiler con fechas)
CREATE TABLE RENTAS (
    ID_RENTA        NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_CLIENTE      NUMBER NOT NULL REFERENCES CLIENTES(ID_CLIENTE),
    ID_ALMACEN      NUMBER NOT NULL REFERENCES ALMACENES(ID_ALMACEN),
    FECHA_INICIO    DATE   NOT NULL,
    FECHA_FIN       DATE   NOT NULL,
    MONTO           NUMBER(10,2)
);

-- Índices útiles (opcional)
CREATE INDEX IDX_USUARIOS_USUARIO ON USUARIOS(USUARIO);
CREATE INDEX IDX_SEDES_ADMIN      ON SEDES(ID_ADMIN_SEDE);
CREATE INDEX IDX_ALM_SEDE         ON ALMACENES(ID_SEDE);
CREATE INDEX IDX_VENTAS_CLIENTE   ON VENTAS(ID_CLIENTE);
CREATE INDEX IDX_RENTAS_CLIENTE   ON RENTAS(ID_CLIENTE);



-- SUPERADMIN de prueba
INSERT INTO USUARIOS (NOMBRE, APELLIDO, CORREO, USUARIO, CONTRASEÑA, ROL)
VALUES ('Root', 'System', 'root@demo.local', 'superadmin',
        '$2a$10$T2o6Y5m0wVdZxA0F3x7vUO0s8eP3l1Q2k4n6r8t9u1v3w5x7y9z1G',  -- bcrypt("12345") de ejemplo
        'SUPERADMIN');

-- ADMIN_SEDE de prueba sin sede asignada (aún)
INSERT INTO USUARIOS (NOMBRE, APELLIDO, CORREO, USUARIO, CONTRASEÑA, ROL)
VALUES ('Ana', 'Admin', 'ana.admin@demo.local', 'admin_sede',
        '$2a$10$T2o6Y5m0wVdZxA0F3x7vUO0s8eP3l1Q2k4n6r8t9u1v3w5x7y9z1G',
        'ADMIN_SEDE');

-- Una sede demo
INSERT INTO SEDES (MUNICIPIO, ID_ADMIN_SEDE, TELEFONO) VALUES ('Cuernavaca', NULL, '7771234567');

-- Clientes demo
INSERT INTO CLIENTES (NOMBRE, APELLIDOS, TELEFONO, CORREO) VALUES ('Juan', 'Pérez', '7771112233', 'juan@demo.local');
INSERT INTO CLIENTES (NOMBRE, APELLIDOS, TELEFONO, CORREO) VALUES ('María', 'López', '7772223344', 'maria@demo.local');

-- Almacenes demo (disponibles)
INSERT INTO ALMACENES (NOMBRE, UBICACION, CAPACIDAD, PRECIO_RENTA, PRECIO_VENTA, DISPONIBLE, ID_SEDE)
VALUES ('Alm-01', 'Norte', 100, 2500, 150000, 'S', 1);
INSERT INTO ALMACENES (NOMBRE, UBICACION, CAPACIDAD, PRECIO_RENTA, PRECIO_VENTA, DISPONIBLE, ID_SEDE)
VALUES ('Alm-02', 'Centro', 80,  2200, 120000, 'S', 1);

COMMIT;
