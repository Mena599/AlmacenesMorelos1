-- ========================================
-- SCRIPT SQL ORACLE - PROYECTO ALMACENES MORELOS
-- ========================================

-- USUARIO (Superadmin, admin, cliente general)
CREATE TABLE USUARIO (
    ID_USUARIO       NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOMBRE_USUARIO   VARCHAR2(50) NOT NULL UNIQUE,
    PASSWORD_HASH    VARCHAR2(255) NOT NULL,
    TIPO_USUARIO     VARCHAR2(20) NOT NULL CHECK (TIPO_USUARIO IN ('SUPERADMIN', 'ADMIN', 'CLIENTE'))
);

-- SEDE (Ubicación física que administra un usuario)
CREATE TABLE SEDE (
    ID_SEDE           VARCHAR2(10) PRIMARY KEY,
    NOMBRE_SEDE       VARCHAR2(100) NOT NULL,
    UBICACION         VARCHAR2(150) NOT NULL,
    ESTADO            VARCHAR2(15) CHECK (ESTADO IN ('ACTIVO', 'INACTIVO')),
    USUARIO_ID_USUARIO NUMBER,
    CONSTRAINT FK_SEDE_USUARIO FOREIGN KEY (USUARIO_ID_USUARIO)
        REFERENCES USUARIO(ID_USUARIO) ON DELETE SET NULL
);

-- ALMACÉN (unidad que se renta o vende)
CREATE TABLE ALMACEN (
    ID_ALMACEN        VARCHAR2(10) PRIMARY KEY,
    TAMANO            NUMBER(10,2) NOT NULL,
    PRECIO_RENTA      NUMBER(10,2),
    PRECIO_VENTA      NUMBER(10,2),
    UBICACION         VARCHAR2(150),
    SEDE_ID_SEDE      VARCHAR2(10),
    CONSTRAINT FK_ALMACEN_SEDE FOREIGN KEY (SEDE_ID_SEDE)
        REFERENCES SEDE(ID_SEDE) ON DELETE SET NULL
);

-- CLIENTE (quien renta o compra un almacén)
CREATE TABLE CLIENTE (
    ID_CLIENTE          VARCHAR2(10) PRIMARY KEY,
    NOMBRE              VARCHAR2(50) NOT NULL,
    APELLIDO            VARCHAR2(50) NOT NULL,
    CORREO_ELECTRONICO  VARCHAR2(100),
    TELEFONO            VARCHAR2(20)
);

-- CONTRATO (relación entre cliente y almacén)
CREATE TABLE CONTRATO (
    ID_CONTRATO       VARCHAR2(15) PRIMARY KEY,
    TIPO_CONTRATO     VARCHAR2(10) NOT NULL CHECK (TIPO_CONTRATO IN ('RENTA', 'VENTA')),
    FECHA_INICIO      DATE NOT NULL,
    FECHA_FIN         DATE,
    ESTADO            VARCHAR2(15) CHECK (ESTADO IN ('ACTIVO', 'FINALIZADO')),
    CLIENTE_ID_CLIENTE VARCHAR2(10),
    CONSTRAINT FK_CONTRATO_CLIENTE FOREIGN KEY (CLIENTE_ID_CLIENTE)
        REFERENCES CLIENTE(ID_CLIENTE) ON DELETE CASCADE
);

-- PAGO (pago relacionado a un contrato)
CREATE TABLE PAGO (
    ID_PAGO           VARCHAR2(15) PRIMARY KEY,
    MONTO             NUMBER(10,2) NOT NULL,
    ESTADO_PAGO       VARCHAR2(15) CHECK (ESTADO_PAGO IN ('PAGADO', 'PENDIENTE')),
    FECHA_PAGO        DATE DEFAULT CURRENT_DATE,
    CONTRATO_ID_CONTRATO VARCHAR2(15),
    CONSTRAINT FK_PAGO_CONTRATO FOREIGN KEY (CONTRATO_ID_CONTRATO)
        REFERENCES CONTRATO(ID_CONTRATO) ON DELETE CASCADE
);

